import{a as d}from"./axios-L6U4YIEh.js";import{_ as k,c as u,a as t,F as y,i as E,g as h,t as g,b as n,w as U,r as x,o as m,d as V,h as C,v as I,n as v}from"./index-yAzQYw72.js";var T={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"vuejs",BASE_URL:"/2023vueWeek6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:i,VITE_PATH:c}=T,q={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{}}},components:{},mounted(){this.getProducts(),this.getCart()},methods:{getProducts(){const a=`${i}/v2/api/${c}/products`;d.get(a).then(e=>{this.products=e.data.products}).catch(e=>{alert(e.response.data.message)})},getProduct(a){const e=`${i}/v2/api/${c}/product/${a}`;this.loadingStatus.loadingItem=a,d.get(e).then(o=>{this.loadingStatus.loadingItem="",this.product=o.data.product,this.$refs.userProductModal.openModal()}).catch(o=>{alert(o.response.data.message)})},getCart(){const a=`${i}/v2/api/${c}/cart`;d.get(a).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.response.data.message)})},addToCart(a,e=1){const o=`${i}/v2/api/${c}/cart`;this.loadingStatus.loadingItem=a;const _={product_id:a,qty:e};this.$refs.userProductModal.hideModal(),d.post(o,{data:_}).then(s=>{alert(s.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(s=>{alert(s.response.data.message)})},deleteAllCarts(){const a=`${i}/v2/api/${c}/carts`;d.delete(a).then(e=>{alert(e.data.message),this.getCart()}).catch(e=>{alert(e.response.data.message)})},removeCartItem(a){const e=`${i}/v2/api/${c}/cart/${a}`;this.loadingStatus.loadingItem=a,d.delete(e).then(o=>{alert(o.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(o=>{alert(o.response.data.message)})},updateCart(a){const e=`${i}/v2/api/${c}/cart/${a.id}`;this.loadingStatus.loadingItem=a.id;const o={product_id:a.product_id,qty:a.qty};d.put(e,{data:o}).then(_=>{alert(_.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(_=>{alert(_.response.data.message)})},createOrder(){const a=`${i}/v2/api/${c}/order`,e=this.form;d.post(a,{data:e}).then(o=>{alert(o.data.message),this.$refs.form.resetForm(),this.getCart()}).catch(o=>{alert(o.response.data.message)})}}},P=t("h2",null,"購物車列表",-1),w={class:"mt-4"},A={class:"text-end"},B={class:"table align-middle"},M=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),D=["onClick","disabled"],R={key:0,class:"fas fa-spinner fa-pulse"},L={key:0,class:"text-success"},N={class:"input-group input-group-sm"},O={class:"input-group mb-3"},F=["onUpdate:modelValue","onBlur","disabled"],j={class:"input-group-text",id:"basic-addon2"},H={class:"text-end"},$={key:0,class:"text-success"},z=t("td",{colspan:"3",class:"text-end"},"總計",-1),W={class:"text-end"},G={key:0},J=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),K={class:"text-end text-success"},Q={class:"my-5 row justify-content-center"},X={class:"mb-3"},Y=t("label",{for:"email",class:"form-label"},"Email",-1),Z={class:"mb-3"},tt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),et={class:"mb-3"},st=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),at={class:"mb-3"},lt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),ot={class:"mb-3"},rt=t("label",{for:"message",class:"form-label"},"留言",-1),nt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function dt(a,e,o,_,s,p){const f=x("v-field"),b=x("error-message"),S=x("v-form");return m(),u(y,null,[P,t("div",w,[t("div",A,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...l)=>p.deleteAllCarts&&p.deleteAllCarts(...l))}," 清空購物車 ")]),t("table",B,[M,t("tbody",null,[s.cart.carts?(m(!0),u(y,{key:0},E(s.cart.carts,l=>(m(),u("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>p.removeCartItem(l.id),disabled:s.loadingStatus.loadingItem===l.id},[s.loadingStatus.loadingItem===l.id?(m(),u("i",R)):h("",!0),V(" x ")],8,D)]),t("td",null,[V(g(l.product.title)+" ",1),l.coupon?(m(),u("div",L,"已套用優惠券")):h("",!0)]),t("td",null,[t("div",N,[t("div",O,[C(t("input",{"onUpdate:modelValue":r=>l.qty=r,onBlur:r=>p.updateCart(l),disabled:s.loadingStatus.loadingItem===l.id,min:"1",type:"number",class:"form-control"},null,40,F),[[I,l.qty,void 0,{number:!0}]]),t("span",j,g(l.product.unit),1)])])]),t("td",H,[s.cart.final_total!==s.cart.total?(m(),u("small",$,"折扣價：")):h("",!0),V(" "+g(l.final_total),1)])]))),128)):h("",!0)]),t("tfoot",null,[t("tr",null,[z,t("td",W,g(s.cart.total),1)]),s.cart.final_total!==s.cart.total?(m(),u("tr",G,[J,t("td",K,g(s.cart.final_total),1)])):h("",!0)])]),t("div",Q,[n(S,{ref:"form",class:"col-md-6",onSubmit:p.createOrder},{default:U(({errors:l})=>[t("div",X,[Y,n(f,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.user.email=r)},null,8,["class","modelValue"]),n(b,{name:"email",class:"invalid-feedback"})]),t("div",Z,[tt,n(f,{id:"name",name:"姓名",type:"text",class:v(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.user.name=r)},null,8,["class","modelValue"]),n(b,{name:"姓名",class:"invalid-feedback"})]),t("div",et,[st,n(f,{id:"tel",name:"電話",type:"text",class:v(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:s.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=r=>s.form.user.tel=r)},null,8,["class","modelValue"]),n(b,{name:"電話",class:"invalid-feedback"})]),t("div",at,[lt,n(f,{id:"address",name:"地址",type:"text",class:v(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=r=>s.form.user.address=r)},null,8,["class","modelValue"]),n(b,{name:"地址",class:"invalid-feedback"})]),t("div",ot,[rt,C(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=r=>s.form.message=r)},null,512),[[I,s.form.message]])]),nt]),_:1},8,["onSubmit"])])])],64)}const ut=k(q,[["render",dt]]);export{ut as default};
